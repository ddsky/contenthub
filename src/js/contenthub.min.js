const ContentHub=function ContentHub(){let chConfig;const CONTENT_HUB_API_BASE="https://api.contenthub.cloud/";function replaceTemplateValues(){let chValueNodes=document.getElementsByClassName("ch-value");for(let i=0;i<chValueNodes.length;i++){const element=chValueNodes[i];let elementHtml=element.innerHTML,fieldPlaceHolders=elementHtml.match(/#.*?#/g);for(let f=0;f<fieldPlaceHolders.length;f++){let instructions,iParts=fieldPlaceHolders[f].replace(/#/g,"").split(".");if(iParts.length<2)continue;let oReq=new XMLHttpRequest;oReq.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){let parsedResponse=JSON.parse(this.response);console.log(parsedResponse),elementHtml=elementHtml.replace(fieldPlaceHolders[f],parsedResponse[iParts[1]].value),element.innerHTML=elementHtml}},oReq.open("GET",CONTENT_HUB_API_BASE+"projects/"+chConfig.projectId+"/documents/"+iParts[0]+"/field?key="+encodeURIComponent(iParts[1])+"&apiKey="+chConfig.apiKey),oReq.send()}}}function initializeStream(){if(!chConfig.stream)return;const xhr=new XMLHttpRequest;let offset=0,totalVisible=0,dateOptions=chConfig.dateOptions||{weekday:"long",year:"numeric",month:"long",day:"numeric"},rootId=chConfig.stream.rootId;0===rootId.indexOf("#")&&(rootId=rootId.substring(1));const templateHtml=document.getElementsByClassName("ch-document")[0].outerHTML;let rootNode=document.getElementById(rootId);rootNode.innerHTML="";const reqDoc={offset:0,number:chConfig.stream.number||10,filters:chConfig.stream.filters||[]};function requestStream(){xhr.open("POST",CONTENT_HUB_API_BASE+"projects/"+chConfig.projectId+"/documents/filter?apiKey="+chConfig.apiKey,!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(JSON.stringify(reqDoc))}let documentsCallback=response=>{let showMoreWrapperNodes=document.getElementsByClassName("ch-show-more-wrapper");for(let i=0;i<showMoreWrapperNodes.length;i++)rootNode.removeChild(showMoreWrapperNodes[i]);let backlinkNode=document.getElementById("ch-backlink");backlinkNode&&rootNode.removeChild(backlinkNode),console.log(response);for(let i=0;i<response.documents.length;i++){let doc=response.documents[i],filledTemplate=templateHtml,fieldPlaceHolders=(filledTemplate=(filledTemplate=(filledTemplate=(filledTemplate=filledTemplate.replace("#title#",doc.title)).replace("#creationdate#",new Date(doc.creationDate).toLocaleDateString(void 0,dateOptions))).replace("#lastmodificationdate#",new Date(doc.lastModificationDate).toLocaleDateString(void 0,dateOptions))).replace("#publishdate#",new Date(doc.publishDate).toLocaleDateString(void 0,dateOptions))).match(/#[a-zA-Z]+[a-zA-Z0-9 ]*?#/g);for(let f=0;f<fieldPlaceHolders.length;f++){let key=fieldPlaceHolders[f].replace(/#/g,"");for(let k=0;k<doc.fields.length;k++){let field=doc.fields[k];if(field.key.toLowerCase()===key){filledTemplate=filledTemplate.replace(fieldPlaceHolders[f],field.value);break}}filledTemplate=filledTemplate.replace(fieldPlaceHolders[f],"")}filledTemplate=filledTemplate.trim();let temp=document.createElement("template");temp.innerHTML=filledTemplate;let entry=temp.content.firstChild;rootNode.appendChild(entry)}totalVisible+=response.documents.length;let rest=response.matches-totalVisible,showMoreConfig=chConfig.stream.showMore||{showButton:!0,html:'<div class="ch-show-more-wrapper"><div class="ch-show-more"><svg id="ch-show-more-loader" width="30px"  height="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-ripple" style="background: none;"><circle cx="50" cy="50" r="39.3993" fill="none" ng-attr-stroke="{{config.c1}}" ng-attr-stroke-width="{{config.width}}" stroke="#ffffff" stroke-width="4"><animate attributeName="r" calcMode="spline" values="0;30" keyTimes="0;1" dur="1.7" keySplines="0 0.2 0.8 1" begin="-0.85s" repeatCount="indefinite"></animate><animate attributeName="opacity" calcMode="spline" values="1;0" keyTimes="0;1" dur="1.7" keySplines="0.2 0 0.8 1" begin="-0.85s" repeatCount="indefinite"></animate></circle><circle cx="50" cy="50" r="23.731" fill="none" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" stroke="#ffffff" stroke-width="4"><animate attributeName="r" calcMode="spline" values="0;30" keyTimes="0;1" dur="1.7" keySplines="0 0.2 0.8 1" begin="0s" repeatCount="indefinite"></animate><animate attributeName="opacity" calcMode="spline" values="1;0" keyTimes="0;1" dur="1.7" keySplines="0.2 0 0.8 1" begin="0s" repeatCount="indefinite"></animate></circle></svg>Show more (#rest# left)</div></div>'};if(showMoreConfig.showButton&&rest>0){reqDoc.offset+=reqDoc.number;let temp=document.createElement("template");temp.innerHTML=showMoreConfig.html.replace("#rest#",rest);let button=temp.content.firstChild;button.firstChild.onclick=(()=>{let loader=document.getElementById("ch-show-more-loader");loader&&(loader.style="display:initial"),requestStream()}),rootNode.appendChild(button)}let temp=document.createElement("template");temp.innerHTML='<a id="ch-backlink" href="https://contenthub.cloud">via Content Hub</a>';let backlink=temp.content.firstChild;rootNode.appendChild(backlink)};xhr.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&documentsCallback(JSON.parse(this.response))},requestStream()}return{setConfig(config){config&&(chConfig=config)},init(config){if(this.setConfig(config),!chConfig)throw new Error('No "chConfig" object found.');if(!chConfig.apiKey)throw new Error('No "apiKey" in chConfig object found.');if(!chConfig.projectId)throw new Error('No "projectId" in chConfig object found.');if(chConfig.stream&&!chConfig.stream.rootId)throw new Error('No "rootId" in chConfig.stream object found.');replaceTemplateValues(),initializeStream()}}}();export default ContentHub;